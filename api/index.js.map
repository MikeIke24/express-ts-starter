{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import express = require('express');\nimport axios from 'axios';\n\nconst app = express();\n\nlet accessToken;\n\ninterface IAuthReq {\n    client_id: string;\n    client_secret: string;\n    Resource: string;\n    grant_type: string;\n}\n\ninterface IAuthRes {\n    token_type: string;\n    expires_in: string;\n    ext_expires_in: string;\n    expires_on: string;\n    not_before: string;\n    resource: string;\n    access_token: string;\n}\n\napp.use(function (req: express.Request, res: express.Response, next) {\n    console.log('Time:', Date.now());\n    // Check req obj for any needed headers\n    const token = req.header('access_token');\n    if (token && token.length > 1) {\n        accessToken = token;\n        next();\n    } else {\n        const authBody: IAuthReq = {\n            client_id: ' 466c8f34-e2af-42bb-87c2-4802206168f7',\n            client_secret: 'islsiVY6tCzezyBOHkkiMEXK7Nq07mCyj3MurrvzdYU=',\n            Resource: '2cd2fb9a-18c2-4eb1-931b-8885c6151548',\n            grant_type: 'client_credentials'\n        };\n        const url = 'https://login.microsoftonline.com/2a3033c2-ad76-426c-9c5a23233cde4cde/oauth2/token';\n        const headers = {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        };\n        axios.post<IAuthRes>(url, authBody, {headers: headers}).then(res => {\n            accessToken = res.data.access_token;\n            next();\n        }).catch(err => {\n            throw err;\n        });\n    }\n\n});\n\napp.get('/hello', (req: express.Request, res: express.Response) => {\n    console.log(accessToken);\n    res.send('Hello from the project root!')\n});\n\napp.get('*', (req: express.Request, res: express.Response) => {\n    res.send({\n        env: process.env,\n        port: process.env.port\n    })\n});\n\n// catch 404 and forward to error handler\napp.use(function (req: express.Request, res: express.Response, next) {\n    let err = new Error('Not Found');\n    err['status'] = 404;\n    next(err);\n});\n\n// error handlers\n\n// development error handler\n// will print stacktrace\nif (app.get('env') === 'development') {\n    app.use((err: any, req: express.Request, res: express.Response) => {\n        res.status(err['status'] || 500);\n        res.send({\n            message: err.message,\n            error: err\n        });\n    });\n}\n\n// production error handler\n// no stacktraces leaked to user\napp.use((err: any, req: express.Request, res: express.Response) => {\n    res.status(err.status || 500);\n    res.send({\n        message: err.message,\n        error: {}\n    });\n});\n\napp.set('port', process.env.port || 8080);\n\napp.listen(8080, () => {\n    console.log('App started!!');\n});\n"]}